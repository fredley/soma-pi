{% extends "base.html" %}

{% block jquery %}

$('#search-box').keyup(function() {
    $('.station').each(function(){
        if($(this).attr('name').toLowerCase().indexOf($('#search-box').val().toLowerCase()) == -1){
            $(this).hide();
        }else{
            $(this).show();
        }
    });
});

function update_info(){
  $.ajax("/ajax/home",{
    type: "GET",
  }).always(function (response) {
      results = JSON.parse(response['responseText']);
      if(results['success']){
          if(results['status'] == 'stop'){
              $('#info-station-outer').hide(); 
              $('#info-track-outer').hide(); 
              $('#info-status').text("Stopped");
              $('#stop-button').attr('disabled','disabled');
          }else{
              $('#info-station-outer').show(); 
              $('#info-track-outer').show(); 
              $('#info-station').text(results['station']); 
              $('#info-track').text(results['song']);    
              $('#info-status').text(results['status']);   
              $('#stop-button').removeAttr('disabled');
              $('#info-status').text("Playing");
          }
      }else{
          $('#info-status').text("Error: " + results['error']);
          $('#info-station').text('');
          $('#info-track').text('');
      }
    setTimeout(function(){update_info();}, 10000);
    });
};

update_info();

{% endblock %}

{% block content %}

<div class='container'>

<header class="jumbotron" id="overview">
  <div class="container">
    <h1>Soma Pi</h1>
    <p class="lead">SomaFM Control Station</p>
      <pre>Status: <span id='info-status'></span>
<span id='info-station-outer'>Listening to: <span id='info-station'></span></span>
<span id='info-track-outer'>Current Track: <span id='info-track'></span></span></pre>
      <p>
        <a class="btn btn-danger" href='{% url "stop" %}' id='stop-button'>
            <i class='icon-stop icon-white'></i> Stop
        </a>
        <a class="btn btn-inverse" href='{% url "random" %}'>
            <i class='icon-random icon-white'></i> Random
        </a>
      </p>
  </div>
</header>

<div class='row'>
  <form class="form-search">
    <input type="text" id="search-box" class="span12 search-query" placeholder="Filter" />
  </form>
</div>

<ul class="thumbnails">

{% for station in stations %}

{% if forloop.counter0|divisibleby:3 and not forloop.counter0 == 0 %}
{% endif %}

<li class="span4 station" name="{{ station.name }}">
  <div class="thumbnail">
    <h3>{{ station.name }}</h3>
    <img src='{{ station.image }}' alt="" class="img-rounded">
    <a class='btn btn-large btn-danger' href='{% url "play" station.id %}'><i class='icon-play icon-white'></i> Play</a>
    <p>{{ station.description }}</p>
  </div>
</li>

{% endfor %}

</ul>

</div>

{% endblock %}
